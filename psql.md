```
db=> \dt
             List of relations
 Schema |     Name      | Type  |   Owner   
--------+---------------+-------+-----------
 public | order_product | table | devops
 public | orders        | table | devops
 public | product       | table | devops
(3 rows)
```
```
db=> \d product
                                     Table "public.product"
   Column    |          Type          | Collation | Nullable |             Default              
-------------+------------------------+-----------+----------+----------------------------------
 id          | bigint                 |           | not null | generated by default as identity
 name        | character varying(255) |           | not null |
 picture_url | character varying(255) |           |          |
 price       | double precision       |           |          |

SELECT * FROM product LIMIT 20; 

SELECT AVG(price) FROM product;

UPDATE product SET price = 1000 WHERE id = 1;
```
```
SELECT o.date_created, SUM(op.quantity)
FROM orders AS o 
JOIN order_product AS op ON o.id = op.order_id
GROUP BY o.date_created;

WHERE o.status = 'shipped' AND o.date_created > NOW() - INTERVAL '7 DAY'

GROUP BY o.date_created;
```
```

SELECT o.date_created, SUM(op.quantity)
FROM orders AS o
    JOIN order_product AS op ON o.id = op.order_id
WHERE o.status = 'shipped' AND o.date_created > NOW() - INTERVAL '7 DAY'
GROUP BY o.date_created;
 date_created |  sum   
--------------+--------
 2025-02-12   | 939583
 2025-02-13   | 943989
 2025-02-14   | 940213
 2025-02-15   | 941022
 2025-02-16   | 939310
 2025-02-17   | 943853
 2025-02-18   | 554297
(7 rows)

db=> \timing
Timing is on.

SELECT tablename, indexname, indexdef
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY tablename, indexname; 


CREATE INDEX idx_status ON order(status, date_created); 


BEGIN;
INSERT INTO orders (id, status) VALUES (1, 'pending');
INSERT INTO order_product (order_id, product_id, quantity) VALUES (1, 1, 10);
COMMIT;
```


# создание дампа в 8 потоков, в формате директории
pg_dump postgresql://$PSQL_USER:$PSQL_PASSWORD@$PSQL_HOST:$PSQL_PORT/$PSQL_DBNAME -j 8 -Fd -f /tmp/dump.dir

# выгрузка дампа в формате директории
pg_restore -d "postgresql://$PSQL_USER:$PSQL_PASSWORD@$PSQL_HOST:$PSQL_PORT/$PSQL_DBNAME" --format=d /tmp/dump.dir/

